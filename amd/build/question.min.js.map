{"version":3,"sources":["../src/question.js"],"names":["define","t","currentHeight","init","window","frameElement","resizeContainingFrame","document","compatMode","setInterval","documentElement","style","height","querySelectorAll","forEach","element","hasAttribute","setAttribute","Y","use","M","core_formchangechecker","formid","body","offsetHeight"],"mappings":"AAwBAA,OAAM,iCAAC,EAAD,CAAK,UAAW,CAClB,GAAIC,CAAAA,CAAC,CAAG,CAIJC,aAAa,CAAE,IAJX,CASJC,IAAI,CAAE,eAAW,CAEb,GAAI,CAACC,MAAM,CAACC,YAAZ,CAA0B,CACtB,MACH,CAGDJ,CAAC,CAACK,qBAAF,GAMA,GAAmC,WAA/B,QAAOC,CAAAA,QAAQ,CAACC,UAAhB,EAAsE,YAAxB,GAAAD,QAAQ,CAACC,UAA3D,CAAwF,CACpFC,WAAW,CAACR,CAAC,CAACK,qBAAH,CAA0B,GAA1B,CACd,CAKDC,QAAQ,CAACG,eAAT,CAAyBC,KAAzB,CAA+B,YAA/B,EAA+C,QAA/C,CACAJ,QAAQ,CAACG,eAAT,CAAyBC,KAAzB,CAA+BC,MAA/B,CAAwC,MAAxC,CAGAL,QAAQ,CAACM,gBAAT,CAA0B,iBAA1B,EAA6CC,OAA7C,CAAqD,SAASC,CAAT,CAAkB,CACnE,GAAI,CAACA,CAAO,CAACC,YAAR,CAAqB,QAArB,CAAL,CAAqC,CACjCD,CAAO,CAACE,YAAR,CAAqB,QAArB,CAA+B,MAA/B,CACH,CACJ,CAJD,EAMAC,CAAC,CAACC,GAAF,CAAM,+BAAN,CAAuC,UAAW,CAC9CC,CAAC,CAACC,sBAAF,CAAyBlB,IAAzB,CAA8B,CAACmB,MAAM,CAAE,cAAT,CAA9B,CACH,CAFD,CAGH,CA1CG,CA+CJhB,qBAAqB,CAAE,gCAAW,CAM9B,GAAIL,CAAC,CAACC,aAAF,GAAoBK,QAAQ,CAACgB,IAAT,CAAcC,YAAtC,CAAoD,CAChD,MACH,CAGDvB,CAAC,CAACC,aAAF,CAAkBK,QAAQ,CAACgB,IAAT,CAAcC,YAAhC,CAEApB,MAAM,CAACC,YAAP,CAAoBM,KAApB,CAA0BC,MAA1B,CAAoCX,CAAC,CAACC,aAAF,CAAkB,EAAnB,CAAyB,IAC/D,CA7DG,CAAR,CA+DA,MAAOD,CAAAA,CACV,CAjEK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/*\r\n * The module resizes the iframe containing the embedded question to be\r\n * just the right size for the question.\r\n *\r\n * @module    filter_embedquestion/question\r\n * @package   filter_embedquestion\r\n * @copyright 2018 The Open University\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine([], function() {\r\n    var t = {\r\n        /**\r\n         * The last height we set on the iframe, so we only try to change it when it changes.\r\n         */\r\n        currentHeight: null,\r\n\r\n        /**\r\n         * Initialise method.\r\n         */\r\n        init: function() {\r\n            // Only initialise if we are in a frame.\r\n            if (!window.frameElement) {\r\n                return;\r\n            }\r\n\r\n            // Initialise the resize logic.\r\n            t.resizeContainingFrame();\r\n\r\n            // If something like an error causes junk to be output before the open <html> tag,\r\n            // then that puts the document into BackCompat rendering mode, and the iframe keeps\r\n            // getting bigger and bigger. So, only do the continual resize logic if the browser\r\n            // is in standards compliant rendering mode.\r\n            if (typeof document.compatMode !== 'undefined' && document.compatMode !== \"BackCompat\") {\r\n                setInterval(t.resizeContainingFrame, 100);\r\n            }\r\n\r\n            // Prevent a vertical scroll-bar in all cases.\r\n            // We can't do this in the CSS, because there is no suitable class on\r\n            // the <html> tag.\r\n            document.documentElement.style['overflow-y'] = 'hidden';\r\n            document.documentElement.style.height = 'auto';\r\n\r\n            // Make the edit question link (if present) open in the full window.\r\n            document.querySelectorAll('.editquestion a').forEach(function(element) {\r\n                if (!element.hasAttribute('target')) {\r\n                    element.setAttribute('target', '_top');\r\n                }\r\n            });\r\n\r\n            Y.use('moodle-core-formchangechecker', function() {\r\n                M.core_formchangechecker.init({formid: 'responseform'});\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Set the size of the containing frame to what we need.\r\n         */\r\n        resizeContainingFrame: function() {\r\n            // It seems sensible to use scrollHeight in this function, but that is\r\n            // buggy in Safari. https://bugs.webkit.org/show_bug.cgi?id=25240 has\r\n            // a useful table showing that body.offsetHeight is reliable.\r\n\r\n            // Has the height changed?\r\n            if (t.currentHeight === document.body.offsetHeight) {\r\n                return; // No.\r\n            }\r\n\r\n            // Resize required. Do it.\r\n            t.currentHeight = document.body.offsetHeight;\r\n            // Extra height to allow for any horizontal scroll bar.\r\n            window.frameElement.style.height = (t.currentHeight + 25) + \"px\";\r\n        }\r\n    };\r\n    return t;\r\n});\r\n"],"file":"question.min.js"}